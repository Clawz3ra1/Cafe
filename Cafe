local function createESP(player)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local billboard = Instance.new("BillboardGui")
        billboard.Adornee = player.Character.HumanoidRootPart
        billboard.Size = UDim2.new(4, 0, 6, 0)
        billboard.StudsOffset = Vector3.new(0, 2, 0)
        billboard.AlwaysOnTop = true
        
        local frame = Instance.new("Frame", billboard)
        frame.Size = UDim2.new(1, 0, 1, 0)
        frame.BackgroundTransparency = 0.5
        frame.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        
        billboard.Parent = player.Character
        
        -- Criando a linha
        local line = Instance.new("Part")
        line.Size = Vector3.new(0.1, 0.1, (player.Character.HumanoidRootPart.Position - game.Players.LocalPlayer.Character.HumanoidRootPart.Position).magnitude)
        line.Anchored = true
        line.CanCollide = false
        line.Color = Color3.fromRGB(0, 255, 0)
        line.Material = Enum.Material.Neon
        line.Parent = game.Workspace
        
        -- Criando o Highlight
        local highlight = Instance.new("Highlight")
        highlight.Parent = player.Character
        highlight.FillColor = Color3.fromRGB(255, 0, 0)
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0
        
        game:GetService("RunService").RenderStepped:Connect(function()
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                local startPos = game.Players.LocalPlayer.Character.HumanoidRootPart.Position
                local endPos = player.Character.HumanoidRootPart.Position
                line.Position = (startPos + endPos) / 2
                line.Size = Vector3.new(0.1, 0.1, (endPos - startPos).magnitude)
                line.CFrame = CFrame.lookAt(startPos, endPos)
            else
                line:Destroy()
            end
        end)
    end
end

local function applyESP()
    for _, player in pairs(game.Players:GetPlayers()) do
        if player ~= game.Players.LocalPlayer then
            createESP(player)
        end
    end
end

applyESP()
game.Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        task.wait(1) -- Pequeno delay para garantir que o personagem carregue
        createESP(player)
    end)
end)
